# -*- mode: shell-script -*-

src_file=../src/lib/libpretty.sh

prefix_cmd="
. /etc/shlib

source '$src_file'
pretty:init
"

export COLUMNS=50


##
## Elt
##

try 'Wrap "true"' \
    'with color: "Wrap true" expected sequence of output'
noerror
is out "- true
- true                                         W
- true                                [  OK  ] W" NOCOLOR NOPOS TRIM

try 'Wrap "false"' \
    'with color: "Wrap false" expected sequence of output'
is errlvl 1
is out reg "^- false
- false                                        W
- false                               \[FAILED\] W
Error in wrapped command:
pwd: [^$NL]+
code:
\| false
output \(1\):" NOCOLOR NOPOS TRIM

try 'Wrap -q "true"' \
    'Bare "Wrap true" with quiet mode'
noerror
is out ""

try 'Wrap -q "false"' \
    'Bare "Wrap false" with quiet mode'
is errlvl 1
is out reg "\
Error in wrapped command:
 pwd: [^$NL]+
 code:
  \| false
 output \(1\):
" NOCOLOR

try 'Wrap -d "My command"  "true"' \
    'Bare "Wrap true" with description'
noerror
is out "- My command
- My command                                   W
- My command                          [  OK  ] W" NOPOS NOCOLOR TRIM

try 'Wrap -d "My command" "false"' \
    'Bare wrap with description mode'
is errlvl 1
is out reg "- My command
- My command                                   W
- My command                          \[FAILED\] W
Error in wrapped command:
pwd: [^$NL]+
code:
\| false
output \(1\):" NOCOLOR NOPOS TRIM

try 'Wrap -q -d "My successful command" "true"' \
    'Description "Wrap true" with quiet mode'
noerror
is out "" TRIM

try 'Wrap -q -d "My failing command" "false"' \
    'Description "Wrap false" with quiet mode'
is out reg "\
Error in wrapped command:
pwd: [^$NL]+
code:
| false
output (1):" NOCOLOR TRIM

##
## EOF Mode
##

try 'Wrap -q -d "My failing command" <<EOF

false &&
false &&
false

EOF' \
    'stdin Wrap with description and quiet mode'
is out reg "\
Error in wrapped command:
pwd: [^$NL]*
code:
|
| false &&
| false &&
| false
output (1):" NOCOLOR TRIM

try 'Wrap -q -d "My successful command" <<EOF

false ||
false ||
true

EOF' \
    'Description Wrap succeeding with quiet mode'
is out "" NOCOLOR TRIM

